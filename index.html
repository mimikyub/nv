<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>SDD Explorer</title>
<style>
body {
    font-family: Arial, sans-serif;
}
#fileContent {
    margin-top: 20px;
    white-space: pre-line;
    font-size: 18px;
}
#fileSelector {
    font-size: 18px;
    padding: 5px;
}
.nav-buttons {
    margin-left: 10px;
    font-size: 18px;
    cursor: pointer;
}
.line-separator {
    padding-bottom: 3px;
    margin-bottom: 3px;
}
#searchResults {
    margin-top: 20px;
}
</style>
</head>
<body>

<label for="fileSelector">Sélectionnez un SDD :</label>
<select id="fileSelector" onchange="loadFileContent(this.value)">
    <option value="">-- Choisissez un SDD --</option>
    <option value="001">001 Constipation</option>
    <option value="002">002 Diarrhée</option>
    <option value="003">003 Distension abdominale</option>
    <option value="004">004 Douleur abdominale</option>
    <option value="005">005 Douleur anale</option>
    <option value="006">006 Hépatomégalie</option>
    <!-- Ajoute ici toutes les options jusqu'à 356 -->
</select>
<span class="nav-buttons" onclick="navigateSDD(-1)">←</span>
<span class="nav-buttons" onclick="navigateSDD(1)">→</span>

<div id="fileContent"></div>

<hr>

<!-- Zone de recherche -->
<label for="searchInput">Recherche dans tous les fichiers :</label>
<input type="text" id="searchInput" oninput="searchFiles(this.value)">
<div id="searchResults"></div>

<script>
function applyTagStyles(content) {
    let tagMappings = {
        "#INT": "INT", "#URG": "URG", "#DGP": "DGP", "#COM": "COM", "#ANN": "ANN",
        "#CLI": "CLI", "#ETP": "ETP", "#PEC": "PEC", "#EXA": "EXA", "#PRO": "PRO", "#ICO": "ICO"
    };

    let lines = content.split("\n");
    let formattedContent = lines.map(line => {
        for (let tag in tagMappings) {
            if (line.includes(tag)) {
                return `<div class="${tagMappings[tag]} line-separator">${line}</div>`;
            }
        }
        return `<div class="line-separator">${line}</div>`;
    }).join("");

    return formattedContent;
}

function loadFileContent(fileName) {
    if (!fileName) return;
    fetch(`./nvalt/${fileName}.txt`)
        .then(response => response.text())
        .then(data => {
            document.getElementById('fileContent').innerHTML = `<h2>SDD-${fileName}</h2>${applyTagStyles(data)}`;
        })
        .catch(() => alert("Erreur lors du chargement du fichier."));
}

function navigateSDD(direction) {
    let select = document.getElementById("fileSelector");
    let currentIndex = select.selectedIndex;
    let newIndex = currentIndex + direction;
    if (newIndex >= 1 && newIndex < select.options.length) {
        select.selectedIndex = newIndex;
        loadFileContent(select.value);
    }
}

async function searchFiles(keyword) {
    if (keyword.length < 3) {
        document.getElementById("searchResults").innerHTML = "";
        return;
    }

    let searchResults = document.getElementById("searchResults");
    searchResults.innerHTML = "<p>Recherche en cours...</p>";

    let files = ["001", "002", "003", "004", "005", "006"]; // Liste des fichiers à chercher

    let resultsHTML = "";

    for (let fileName of files) {
        try {
            let response = await fetch(`./nvalt/${fileName}.txt`);
            let text = await response.text();
            let matchingLines = text.split("\n").filter(line => line.toLowerCase().includes(keyword.toLowerCase()));

            if (matchingLines.length > 0) {
                resultsHTML += `<h3>SDD-${fileName}</h3><ul>`;
                matchingLines.forEach(line => {
                    resultsHTML += `<li>${line}</li>`;
                });
                resultsHTML += `</ul>`;
            }
        } catch (error) {
            console.error(`Erreur lors de la lecture du fichier ${fileName}:`, error);
        }
    }

    searchResults.innerHTML = resultsHTML || "<p>Aucun résultat trouvé.</p>";
}
</script>

</body>
</html>

